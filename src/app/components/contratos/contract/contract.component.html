<div class="panel-header">
  <div class="header text-center">
    <h2 class="title">Busqueda de Contratos</h2>
  </div>
</div>
<div class="main-content" *ngIf="first">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <h4 class="card-title"> Contratos</h4>
            <button matTooltip="Agregar Nuevo Contrato" class="btn text-black bg-primary" (click)="activateForm()">
              <i class="fa-solid fa-plus"></i>
              <span></span>
            </button>
          </div>

          <app-filter (changeData)="changeData($event)" [filtersData]="filtersData"></app-filter>

          <div class="card-body">
            <mat-form-field class="w-100">
              <mat-label>Buscar</mat-label>
              <input matInput (keyup)="applyFilter($event)" placeholder="Ingresa datos" #input>
            </mat-form-field>
            <div class="table-responsive">
              <form>
                
                <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
                  <!-- Columna Crámo -->
                  <ng-container matColumnDef="ccontratoflota">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Código </th>
                      <td mat-cell *matCellDef="let element"> {{ element.ccontratoflota }} </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="xnombre">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
                      <td mat-cell *matCellDef="let element"> {{ element.xnombre }} </td>
                      
                    </ng-container>
          
                    <ng-container matColumnDef="xvehiculo">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Vehiculo </th>
                      <td mat-cell *matCellDef="let element"> {{ element.xvehiculo }} </td>
                      
                    </ng-container>
          
                    <ng-container matColumnDef="xplaca">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Placa </th>
                      <td mat-cell *matCellDef="let element"> {{ element.xplaca }} </td>
                      
                    </ng-container>

                    <ng-container matColumnDef="xcompania">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Compañía </th>
                      <td mat-cell *matCellDef="let element"> {{ element.xcompania }} </td>

                    </ng-container>
                    <ng-container matColumnDef="xestatusgeneral">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Estatus </th>
                      <td mat-cell *matCellDef="let element"> {{ element.xestatusgeneral }} </td>
                      
                    </ng-container>
                    
                    <!-- Columna Acciones -->
                    <ng-container matColumnDef="star">
                      <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                      <td mat-cell *matCellDef="let element">
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" type="button">
                          <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                          <button mat-menu-item (click)="openPdf(element.ccontratoflota, element.ccompania)" type="button">
                            <mat-icon>picture_as_pdf</mat-icon>
                            <span>Generar Certificado</span>
                          </button>
                          <button mat-menu-item (click)="viewReceipts(element)" type="button" data-bs-toggle="modal" [attr.data-bs-target]="'#receiptsModal'+element.ccontratoflota">
                            <mat-icon>receipt_long</mat-icon>
                            <span>Recibos</span>
                          </button>
                        </mat-menu>
                      </td>
                      <td style="border-bottom-right-radius:20px;" mat-footer-cell *matFooterCellDef></td>
                    </ng-container>
                    
                      
                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                      
                  <!-- Fila que se muestra cuando no hay datos coincidentes. -->
                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="12">No hay datos</td>
                  </tr>
                </table>
                
                
              </form>
            </div>
            <mat-paginator [length]="length" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" (page)="changeDataPage($event)" aria-label="Seleccionar página de Contratos"></mat-paginator>
            <div *ngFor="let item of dataSource.data">
              <div class="modal fade" [id]="'receiptsModal'+item.ccontratoflota" tabindex="-1" aria-labelledby="receiptsModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div style="max-height: 90%; overflow-y: auto;" class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">Recibos del Contrato #{{item.ccontratoflota}}</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <div class="table-responsive">
                        <table class="table">
                          <thead>
                            <th scope="col" style="width: 70px; max-width: 70px;">Codigo</th>
                            <th scope="col" style="width: 50vw; max-width: 350px;">Vigencia</th>
                            <th scope="col" style="width: 100px; max-width: 100px;">Monto</th>
                            <th scope="col" style="text-align: center;">Estatus</th>
                          </thead>
                          <tbody *ngIf="item.receipts">
                            <tr *ngFor="let element of item.receipts">
                              <td class="table_select" style="width: 40px; max-width: 40px;">{{element.crecibo}}</td>
                              <td class="table_select" style="width: 50vw; max-width: 350px;">({{element.fdesde_rec.toLocaleDateString('en-GB')}} - {{element.fhasta_rec.toLocaleDateString('en-GB')}})</td>
                              <td class="table_select" style="width: 50vw; max-width: 350px;">
                                <span *ngIf="element.cmoneda == 2">{{element.mcosto_ext}}$</span>
                                <span *ngIf="element.cmoneda == 1">{{element.mcosto}} <small>BSF</small></span>
                              </td>
                              <td class="table_select" style="text-align: center;">
                                <button mat-icon-button *ngIf="element.cestatusgeneral == 13" (click)="openPayReceipt(element)" data-bs-toggle="modal" [attr.data-bs-target]="'#receiptModal'+element.crecibo">
                                  <i class="fa-solid fa-triangle-exclamation"></i>
                                </button>
                                <button mat-icon-button *ngIf="element.cestatusgeneral == 7" (click)="openPayReceipt(element)" data-bs-toggle="modal" [attr.data-bs-target]="'#receiptModal'+element.crecibo">
                                  <i class="fa-solid fa-check"></i>
                                </button>
                                <br>
                                <small>{{element.xestatusgeneral}}</small>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                        <div *ngIf="!item.receipts">
                          No existen recibos para este contrato 
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngFor="let element of item.receipts">
                <div class="modal fade" [id]="'receiptModal'+element.crecibo" tabindex="-1" aria-labelledby="receiptsModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div style="max-height: 90%; overflow-y: auto;" class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Recibo #{{element.crecibo}}</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <div class="row">
                          <div class="col-md-3" *ngIf="element.cmoneda == 2">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>Monto</mat-label>
                              <input readonly matInput placeholder="Sin monto registrado" [(ngModel)]="element.mcosto_ext" [value]="element.mcosto_ext">
                              <small matSuffix>USD</small>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3" *ngIf="element.cmoneda == 1">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>Monto</mat-label>
                              <input readonly matInput placeholder="Sin monto registrado" [(ngModel)]="element.mcosto" [value]="element.mcosto">
                              <small matSuffix>BSF</small>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>Fecha Desde</mat-label>
                              <input matInput [matDatepicker]="pickerDesde" [(ngModel)]="element.fdesde_rec" [value]="element.fdesde_rec" readonly>
                              <mat-datepicker-toggle disabled matSuffix [for]="pickerDesde"></mat-datepicker-toggle>
                              <mat-datepicker #pickerDesde></mat-datepicker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>Fecha Hasta</mat-label>
                              <input matInput [matDatepicker]="pickerHasta" [(ngModel)]="element.fhasta_rec" [value]="element.fhasta_rec" readonly>
                              <mat-datepicker-toggle disabled matSuffix [for]="pickerHasta"></mat-datepicker-toggle>
                              <mat-datepicker #pickerHasta></mat-datepicker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <button (click)="element.registerPay = true" *ngIf="element.cestatusgeneral == 13 && element.registerPay == false" class="w-100 btn btn-primary">Registrar Pago</button>
                            <button (click)="registerPayAction(element)" *ngIf="element.cestatusgeneral == 13 && element.registerPay == true" class="w-100 btn btn-primary">Registrar Pago</button>
                          </div>
                        </div>
                        <!-- <div class="row" *ngIf="element.cestatusgeneral == 7 || element.registerPay == true">
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width">
                              <mat-label>Banco Destino</mat-label>
                              <input type="text"
                                placeholder="Seleccione un Banco"
                                *ngIf="element.registerPay"
                                aria-label="Seleccione"
                                matInput
                                [(ngModel)]="element.banco_destino"
                                [value]="element.banco_destino"
                                [matAutocomplete]="bankList"
                              >
                              <input type="text"
                                placeholder="Seleccione un Banco"
                                aria-label="Seleccione"
                                matInput
                                *ngIf="!element.registerPay"
                                readonly
                                [(ngModel)]="element.banco_destino"
                                [value]="element.banco_destino"
                                [matAutocomplete]="bankList"
                              >
                              <mat-autocomplete #bankList="matAutocomplete" (optionSelected)="bankDestinoSelect($event, element)">
                                <mat-option value="" disabled>Seleccione</mat-option>
                                <mat-option *ngFor="let bank of banks" [value]="bank.text">
                                  {{ bank.text }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width">
                              <mat-label>Banco</mat-label>
                              <input type="text"
                                placeholder="Seleccione un Banco"
                                aria-label="Seleccione"
                                matInput
                                *ngIf="element.registerPay"
                                [(ngModel)]="element.bancoS"
                                [value]="element.bancoS"
                                [matAutocomplete]="bankList2"
                              >
                              <input type="text"
                                placeholder="Seleccione un Banco"
                                aria-label="Seleccione"
                                matInput
                                *ngIf="!element.registerPay"
                                readonly
                                [(ngModel)]="element.bancoS"
                                [value]="element.bancoS"
                                [matAutocomplete]="bankList2"
                              >
                              <mat-autocomplete #bankList2="matAutocomplete" (optionSelected)="bankSelect($event, element)">
                                <mat-option value="" disabled>Seleccione</mat-option>
                                <mat-option *ngFor="let bank of banks" [value]="bank.text">
                                  {{ bank.text }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>Fecha de Pago</mat-label>
                              <input matInput *ngIf="!element.registerPay" readonly [matDatepicker]="pickerFPago" [(ngModel)]="element.fcobro" [value]="element.fcobro">
                              <input matInput *ngIf="element.registerPay" [matDatepicker]="pickerFPago" [(ngModel)]="element.fcobro" [value]="element.fcobro">

                              <mat-datepicker-toggle *ngIf="!element.registerPay" disabled matSuffix [for]="pickerFPago"></mat-datepicker-toggle>
                              <mat-datepicker-toggle *ngIf="element.registerPay" matSuffix [for]="pickerFPago"></mat-datepicker-toggle>
                              
                              <mat-datepicker #pickerFPago></mat-datepicker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-3">
                            <mat-form-field class="example-full-width receipt-field">
                              <mat-label>N° de Referencia</mat-label>
                              <input *ngIf="!element.registerPay" readonly matInput placeholder="Coloque el número de referencia" [(ngModel)]="element.xreferencia" [value]="element.xreferencia">
                              <input *ngIf="element.registerPay" matInput placeholder="Coloque el número de referencia" [(ngModel)]="element.xreferencia" [value]="element.xreferencia">
                            </mat-form-field>
                          </div>
                        </div> -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<div class="main-content" *ngIf="second">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <h4 class="card-title text-center"> Creación de Contratos. </h4>
        </div>
        <div class="card-body text-center">
          <div class="row justify-content-center">
            <p class="description-contracts-create">Estimado usuario, por favor seleccione una opción para poder continuar con la operación. ¿Qué tipo de Contrato desea cargar?</p>
            <div class="row w-100 d-flex justify-content-center align-items-center" style="    padding: 0 15px 15px;">
              <!-- <div class="col-md-4 mx-auto">
                <button type="button" class="btn btn-light rounded shadow d-flex p-2 w-100" style=" background:#fcb203; height: 150px;" (click)="corporate()">
                  <div class="d-flex flex-column justify-content-center align-items-center h-100 w-100 rounded" style="background: white; gap: 10px;">
                    <img src="../../../assets/img/corporative.png" >
                    <p class="card-title text-center mb-0" style="color: black; text-transform: uppercase;">
                      <b>Corporativos</b>
                    </p>
                  </div>
                </button>
              </div> -->
              <div class="col-md-4 mx-auto">
                <button type="button" class="btn btn-light rounded shadow d-flex p-2 w-100" style=" background:#fcb203; height: 150px; width: 150px;" (click)="membership()">
                  <div class="d-flex flex-column justify-content-center align-items-center h-100 w-100 rounded" style="background: white; gap: 10px;">
                    <img src="../../../assets/img/membresia.png" >
                    <p class="card-title text-center mb-0" style="color: black; text-transform: uppercase;">
                      <b>Afiliaciones</b>
                    </p>
                  </div>
                </button>
              
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>